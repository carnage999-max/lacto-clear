version: 1
# AWS Amplify Build Configuration for LactoClearÂ®

# Build settings for Next.js application
frontend:
  phases:
    preBuild:
      commands:
        # Install dependencies
        - npm ci
        
    build:
      commands:
        # Build Next.js application
        - npm run build
        
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
      
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*

# Custom headers for security and caching
customHeaders:
  - pattern: '**/*'
    headers:
      - key: 'X-Frame-Options'
        value: 'DENY'
      - key: 'X-Content-Type-Options'
        value: 'nosniff'
      - key: 'X-XSS-Protection'
        value: '1; mode=block'
      - key: 'Referrer-Policy'
        value: 'strict-origin-when-cross-origin'
        
  - pattern: '/products/**'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
        
  - pattern: '/diagrams/**'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'
        
  - pattern: '/logos/**'
    headers:
      - key: 'Cache-Control'
        value: 'public, max-age=31536000, immutable'

# Environment variables (set these in Amplify Console)
# Required environment variables:
# - NEXT_PUBLIC_SITE_URL: https://your-domain.com
# - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY: pk_live_...
# - STRIPE_SECRET_KEY: sk_live_...
# - STRIPE_WEBHOOK_SECRET: whsec_...
# - ADMIN_PASSWORD: your-secure-password
# - SESSION_SECRET: random-32-char-string
# - DATABASE_URL: postgres://... (for RDS/Aurora)
